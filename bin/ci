#!/usr/bin/env bash
set -e

cargo check                                                # check syntax
cargo doc                                                  # check that building docs doesn't error

# run tests with all features
cargo test --features="fnv,log,smallvec"
cargo test --doc --features="fnv,log,smallvec"
cargo test --benches --features="fnv,log,smallvec"
cargo run --example count_records --features="fnv,log,smallvec"

# assert that cargo fmt was used
cargo fmt -- --check

# assert that the README.md was generated using cargo readme
cargo readme > .README.md
diff README.md .README.md

# run tests with no features
cargo test
cargo test --doc
cargo test --benches

# run tests with various combinations of features
cargo test --features="fnv"
cargo test --features="fnv,smallvec"
cargo test --features="smallvec"

echo -e "\033[1;32mSUCCESS\033[0m"
